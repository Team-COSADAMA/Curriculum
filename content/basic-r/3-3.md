---
title: 'ì—°ìŠµë¬¸ì œ'

slug: 3-3

category: '3. ë°ì´í„° ê°€ê³µ'
---

---

### ğŸ§­ ëª©ì°¨

1. midwest ë°ì´í„°
2. mpg ë°ì´í„°
3. avocado ë°ì´í„°

---

ì´ë²ˆ ì¥ì—ì„œëŠ” `%>%` ì—°ì‚°ìë¥¼ í†µí•œ ë°ì´í„° ê°€ê³µì„ ì—°ìŠµí•´ë³´ê² ìŠµë‹ˆë‹¤.

ì½”ë“œë¥¼ ë”°ë¼ ì…ë ¥í•˜ë©´ì„œ ìµìˆ™í•´ì§€ì‹œê¸¸ ë°”ëë‹ˆë‹¤.

```python
# ì‚¬ì „ ì¤€ë¹„
install.packages('ggplot2')
library('ggplot2')
library('dplyr')
```

<br>

### 1) midwest ë°ì´í„°

```python
# 0. ë°ì´í„° ì‚´í´ë³´ê¸°
str(ggplot2::midwest)   # ë¯¸ë¡œë”© íŒ¨í‚¤ì§€ë¥¼ ë¶ˆëŸ¬ì˜¬ ë•Œ

# 1. íŠ¹ì • ì†ì„±(ì—´) ì¶”ì¶œ
mid1 = midwest %>% select(county, state, poptotal, popasian)
glimpse(mid1)

# 2. ì†ì„± ì´ë¦„ ë³€ê²½
mid1 = rename(mid1, asian = popasian, total = poptotal)
head(mid1)

# 3-1. íŒŒìƒë³€ìˆ˜(ìƒˆë¡œìš´ ì†ì„±) ìƒì„±
mid1$pct_asian = (mid1$asian / mid1$total) * 100
head(mid1)
hist(mid1$pct_asian)          # ë¶„í¬ í™•ì¸: íˆìŠ¤í† ê·¸ë¨

# 3-2. íŒŒìƒë³€ìˆ˜ ìƒì„± - ì¡°ê±´ë¬¸ í™œìš©
mid1$degree = ifelse(mid1$pct_asian > mean(mid1$pct_asian), 'large', 'small')
head(mid1)
barplot(table(mid1$degree))   # ë¶„í¬ í™•ì¸: ë§‰ëŒ€ê·¸ë˜í”„

# 3-3. íŒŒìƒë³€ìˆ˜ ìƒì„± - dplyr ë¼ì´ë¸ŒëŸ¬ë¦¬ í™œìš©
mid1 %>% mutate(pct_asian = (asian / total) * 100)
mid1 %>% mutate(degree = ifelse(pct_asian > mean(pct_asian), 'large', 'small'))

# 4. ë°ì´í„° ì •ë ¬
arrange(mid1, pct_asian)      # ì˜¤ë¦„ì°¨ìˆœ ì •ë ¬
```

**ğŸ” í•¨ìˆ˜ ì •ë¦¬**

> 1. ì†ì„± ì´ë¦„ ë³€ê²½
>    - `rename(ë°ì´í„°, new_name = old_name, ...)`
> 2. ë¶„í¬ í™•ì¸ í•¨ìˆ˜
>    - `hist()`: ì—°ì†í˜• ë³€ìˆ˜ì˜ ë¶„í¬ í™•ì¸
>    - `barplot()` : ë²”ì£¼í˜• ë³€ìˆ˜ì˜ ë¶„í¬ í™•ì¸
> 3. íŒŒìƒë³€ìˆ˜ ìƒì„±
>    - `mutate(ë°ì´í„°, ìƒì„±í•  ì—´ì´ë¦„ = ìˆ˜ì‹)`: dplyr ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ í™œìš©
>
> 4. ë°ì´í„° ì •ë ¬
>    - ì˜¤ë¦„ì°¨ìˆœ ì •ë ¬: `arrange(ë°ì´í„°, ì •ë ¬ê¸°ì¤€ ì†ì„±)`
>    - ë‚´ë¦¼ì°¨ìˆœ: `arrange(ë°ì´í„°, desc(ì •ë ¬ê¸°ì¤€ ì†ì„±))`

<br>

### 2) mpg ë°ì´í„°

```python
# ë¬¸ì œ 1: copact ì°¨ëŸ‰ ì œì¡°ì‚¬ ì¤‘ í†µí•©ì—°ë¹„(ë„ì‹œ + ê³ ì†ë„ë¡œ) í‰ê· ì´ ê°€ì¥ ë‚˜ìœ ê³³ì€?

?mpg   # ë°ì´í„° ì‚´í´ë³´ê¸°
View(mpg)

# ëª…ë ¹ì–´ ì‘ì„±
ggplot2::mpg %>% group_by(manufacturer) %>%     # ì œì¡°ì‚¬ë³„ë¡œ ê·¸ë£¹í™”
    filter(class == 'compact') %>%                  # íŠ¹ì • ìƒ˜í”Œ(í–‰) ì¶”ì¶œ
    mutate(total = (hwy + cty) / 2) %>%         # íŒŒìƒë³€ìˆ˜ ìƒì„±
    summarise(total_mean = mean(total)) %>%     # ìš”ì•½ í†µê³„í•¨ìˆ˜
    arrange(total_mean) %>%               # ë‚´ë¦¼ì°¨ìˆœ ì •ë ¬
    head(3)
```

```python
# ë¬¸ì œ 2: fuel typeì´ 'r'ê³¼ 'p'ì¸ ì°¨ ì¤‘, í‰ê·  ë„ì‹œì—°ë¹„ê°€ ê°€ì¥ ë†’ì€ ì°¨ëŠ” ì–´ëŠ ì œì¡°ì‚¬ì—ì„œ ìƒì‚°ë˜ëŠ”ê°€?

mpg %>%
    filter(fl == 'r' | fl == 'p') %>%
    group_by(manufacturer) %>%
    summarise(avg = mean(cty)) %>%
    arrange(desc(avg))
```

```python
# ë¬¸ì œ 3: 1999ë…„ì— ê°€ì¥ ë§ì´ ìƒì‚°ëœ ì°¨ì¢…ì€?

mpg %>%
    filter(year == 1999) %>%
    group_by(class) %>%
    summarise(count = n()) %>%
    arrange(desc(count))
```

<br>

### 3) avocado ë°ì´í„°

- ë°ì´í„°ì…‹ ë‹¤ìš´ë¡œë“œ: [kaggleì˜ 'Avocado Prices'](https://www.kaggle.com/neuromusic/avocado-prices)

```python
# ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸°
avocado <- read.csv('C:/Users/ì‚¬ìš©ìëª…/ë³¸ì¸ì˜ ì‘ì—… ë””ë ‰í† ë¦¬/avocado.csv', header = TRUE, sep = ',')

# ë°ì´í„° í™•ì¸í•˜ê¸°
str(avocado)
```

ì €í¬ê°€ ì‚¬ìš©í•  ì†ì„±ì€ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.

| ì—´ ì´ë¦„(ë³€ìˆ˜ëª…) | ë³€ìˆ˜í˜•             | ë‚´ìš©               |
| --------------- | ------------------ | ------------------ |
| AveragePrice    | num                | ì•„ë³´ì¹´ë„ í‰ê·  ê°€ê²© |
| Total.Volume    | num                | ì•„ë³´ì¹´ë„ ì´ íŒë§¤ëŸ‰ |
| type            | 2ê°œ ë ˆë²¨ì˜ ë²”ì£¼í˜•  | ìœ ê¸°ë† ì—¬ë¶€        |
| year            | int                | ì—°ë„               |
| region          | 54ê°œ ë ˆë²¨ì˜ ë²”ì£¼í˜• | ê´€ì¸¡ ì§€ì—­          |

<br>

ì—°ë„(year), ì§€ì—­(region), ìœ ê¸°ë† ì—¬ë¶€(type)ë¥¼ ê¸°ì¤€ìœ¼ë¡œ, ì•„ë³´ì¹´ë„ì˜ ì´ íŒë§¤ëŸ‰ê³¼ í‰ê·  ê°€ê²©ì„ êµ¬í•´ë³´ê² ìŠµë‹ˆë‹¤. 

```python
# ëª…ë ¹ì–´ì— ê´„í˜¸()ë¥¼ ì”Œìš¸ ê²½ìš°, ì €ì¥ê³¼ ì¶œë ¥ì„ ë™ì‹œì— í•  ìˆ˜ ìˆìŒ
(avo_smry = avocado %>%
  group_by(region, year, type) %>%
  summarise(v_avg = mean(Total.Volume), p_avg = mean(AveragePrice)))
```

<br>

ì´ íŒë§¤ëŸ‰(v_avg)ì„ ê¸°ì¤€ìœ¼ë¡œ ë°ì´í„°ë¥¼ ì •ë ¬í•´ ë³´ê² ìŠµë‹ˆë‹¤.

```python
arrange(avo_smry, desc(v_avg))
```

<br>

ìƒìœ„ 4ê°œì˜ ìƒ˜í”Œ(TotalUS)ì€ ì´í•©ì…ë‹ˆë‹¤. ë°ì´í„° ê°€ê³µ ì‹œ, ë°ì´í„°ì…‹ì— ì¤‘ê°„ í†µê³„ê°’ì´ í¬í•¨ëœ ê²½ìš°ê°€ ìˆìœ¼ë¯€ë¡œ ì£¼ì˜í•˜ëŠ” ê²ƒì´ ì¢‹ìŠµë‹ˆë‹¤.

```python
# ì¤‘ê°„ í†µê³„ê°’ì„ ì œì™¸í•œ ë°ì´í„° ìƒì„±
(avo_smry_x = avo_smry %>%
    filter(region != 'TotalUS') %>%
    arrange(desc(v_avg)))

# ì‹œê°í™” ë§›ë³´ê¸°: ì—°ë„ë³„ ì•„ë³´ì¹´ë„ ì´ íŒë§¤ëŸ‰ì˜ ë³€í™”
avo_smry_x %>%
  ggplot(aes(year, v_avg, col = type)) +
  geom_line() +
  facet_wrap(~region)
```
