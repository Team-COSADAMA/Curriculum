---
title: 'ë©”ì¸ ì¹´í…Œê³ ë¦¬ì˜ ë² ìŠ¤íŠ¸ ìƒí’ˆ í¬ë¡¤ë§'
slug: 6-4
category: '6. [í”„ë¡œì íŠ¸] 11ë²ˆê°€ ì‚¬ì´íŠ¸ ì¹´í…Œê³ ë¦¬ë³„ ë² ìŠ¤íŠ¸ ìƒí’ˆ í¬ë¡¤ë§'
---

ì´ì œ ì¤€ë¹„ê°€ ì™„ë£Œë˜ì—ˆìœ¼ë‹ˆ ë³¸ê²©ì ìœ¼ë¡œ ë©”ì¸ ì¹´í…Œê³ ë¦¬ë¥¼ í¬ë¡¤ë§ í•˜ëŠ” ì½”ë“œë¥¼ í•˜ë‚˜í•˜ë‚˜ ì‘ì„±í•´ë³´ê² ìŠµë‹ˆë‹¤. ë¨¼ì € ê° ë©”ì„œë“œë¥¼ í•˜ë‚˜í•˜ë‚˜ ì‚´í´ë³´ê³ , ì „ì²´ ì½”ë“œë¥¼ ì´í•´í•´ ë´…ì‹œë‹¤.

ê·¸ì „ì—, ì•„ë˜ ì½”ë“œë¥¼ ë³´ë©´ **response.css(quiz)ë¼ê³  ì í˜€ìˆëŠ” ì½”ë“œ**ë“¤ì´ ìˆìŠµë‹ˆë‹¤. ì´ ë¶€ë¶„ì€ **items.py**ì—ì„œ ìƒì„±í•œ í•„ë“œì— ì €ì¥í•  ë°ì´í„°ë“¤ì´ ìœ„ì¹˜í•œ css ì„ íƒì ê²½ë¡œì— í•´ë‹¹í•˜ëŠ” ë‚´ìš©ì¸ë°, 1ì£¼ì°¨ ê³¼ì œì—ì„œ Scrapy shellë¡œ ì°¾ì€ ê²½ë¡œë¥¼ ìˆœì„œëŒ€ë¡œ ì±„ì›Œ ë„£ì–´ì£¼ì‹œê¸°ë§Œ í•˜ë©´ ë©ë‹ˆë‹¤! í•˜ì§€ë§Œ ë„£ê¸°ë§Œ í•˜ë©´ <span style="background-color:#FFD8D8">ë  ê±°ì•¼</span>!ë¼ê³  ë§ˆìŒ ë†“ê¸°ì—” ì¡°ê¸ˆ ì–´ë ¤ìš°ì‹¤ ìˆ˜ë„ ìˆì–´ìš”.

```python
#st11_best.py: 1ë²ˆ(ì£¼ì†Œ ë¶ˆëŸ¬ì˜¤ê¸°)
# ì£¼ì†Œ requestí•˜ê³  callbackí•˜ëŠ” ë©”ì„œë“œ
def start_requests(self):
    yield scrapy.Request(url="https://www.11st.co.kr/browsing/BestSeller.tmall?method=getBestSellerMain&cornerNo=0",
                         callback=self.parse_mainpages) # ì£¼ì†Œë¥¼ ì•„ë˜ ë©”ì„œë“œë¡œ ë³´ë‚´ê³ , response ì²˜ë¦¬ ìš”ì²­
            
# ë©”ì¸ ì¹´í…Œê³ ë¦¬
def parse_mainpages(self, response):
    print("parse_mainpages") # callbackì´ ì˜ ë˜ì—ˆëŠ”ì§€ í™•ì¸í•˜ê¸° ìœ„í•¨
    category_names = response.css(quiz:ë©”ì¸ ì¹´í…Œê³ ë¦¬ëª…ì˜ css ì„ íƒì ê²½ë¡œ).getall() # ë©”ì¸ ì¹´í…Œê³ ë¦¬ì˜ ì´ë¦„ì„ ë¦¬ìŠ¤íŠ¸ë¡œ ë¶ˆëŸ¬ì˜¤ê¸°
    for idx, name in enumerate(category_names):
        # ì´ì œ ê° ë©”ì¸ ì¹´í…Œê³ ë¦¬ ì‚¬ì´íŠ¸ë³„(No=)ë¡œ response ì²˜ë¦¬ ìš”ì²­ì„ ë³´ë‚¼ ê²ƒì„
        yield scrapy.Request(url="https://www.11st.co.kr/browsing/BestSeller.tmall?method=getBestSellerMain&cornerNo="+str(idx), 
                             callback=self.parse_items, # parse_items ë©”ì„œë“œë¥¼ í˜¸ì¶œí•´ì„œ ì‹¤í–‰
                             meta={'maincategory_name':category_names[idx], 'subcategory_name':'All'}) # ì´ ë°ì´í„°ë„ ë‚´ë ¤ë³´ë‚´ì¤Œ
```

```python
#st11_best.py: 2ë²ˆ(ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸°)
def parse_items(self, response):
    print('parse_items', response.meta['maincategory_name'], response.meta['subcategory_name']) # ì˜ ê°€ì ¸ì™€ ì¡ŒëŠ”ì§€ í™•ì¸
    best_items = response.css('div.viewtype.catal_ty') # ë² ìŠ¤íŠ¸ ìƒí’ˆì´ ìœ„ì¹˜í•œ ë©”ì¸ ì„ íƒì ê²½ë¡œ
    for idx, item in enumerate(best_items[1].css('li')): # ê°™ì€ ì„ íƒì ê²½ë¡œê°€ "ë„ì „! ë² ìŠ¤íŠ¸"ë¼ê³  í•˜ë‚˜ ë” ìˆì–´ì„œ, ë‘ë²ˆì§¸ ì„ íƒì ê²½ë¡œë¡œ ì§€ì •í•´ì¤˜ì•¼ í•¨
                                                         # divì˜ classê°€ viewtype.catal_tyì¸ ê²ƒ ì¤‘ 2ë²ˆì§¸ ë‚´ë¶€ì˜ lië“¤ì„ ì´ìš©(&) 
	      doc = St11Item()        
        ranking = idx + 1 # ë­í‚¹ì€ ì¸ë±ìŠ¤ì— 1ì„ ë”í•´ì£¼ë©´ ë¨
				# ì•„ë˜ ë¹ˆì¹¸ì—ëŠ” ë² ìŠ¤íŠ¸ ìƒí’ˆì˜ ì´ë¦„ì— í•´ë‹¹í•˜ëŠ” css ì„ íƒì ê²½ë¡œë¥¼ ë„£ì–´ì£¼ë©´ ë¨. response.cssê°€ ì•„ë‹Œ item.cssì„ì„ ì£¼ì˜!
        title = item.css(quiz:ë² ìŠ¤íŠ¸ ìƒí’ˆëª…ì˜ css ì„ íƒì ê²½ë¡œ).get().strip() # .strip í•¨ìˆ˜ëŠ” pipelines.pyì—ì„œ í•´ì¤˜ë„ ê°€ëŠ¥í•¨. ì•„ë˜ì—ì„œ ì„¤ëª…
        ori_price = item.css(quiz:ê¸°ì¡´ê°€ê²©ì˜ css ì„ íƒì ê²½ë¡œ).get()
        dis_price = item.css(quiz:í• ì¸ê°€ê²©ì˜ css ì„ íƒì ê²½ë¡œ).get() # ë°˜ë³µë¬¸ì´ë‹ˆ getall()ì´ ì•„ë‹Œ get()ì„ ì‚¬ìš©í•¨
        
        if ori_price == None: # í• ì¸í•˜ì§€ ì•ŠëŠ” ìƒí’ˆì€ ê¸°ì¡´ ê°€ê²© ë°ì´í„°ê°€ ì—†ìœ¼ë‹ˆ í• ì¸ ê°€ê²©ê³¼ ê°™ê²Œ ì •í•´ì¤Œ
            ori_price = dis_price

        ori_price = ori_price.replace(',','').replace('ì›','') # ì´í›„ ë¶„ì„ì˜ í¸ë¦¬ë¥¼ ìœ„í•´ ì½¤ë§ˆì™€ 'ì›'ì„ ì‚­ì œ
        dis_price = dis_price.replace(',','').replace('ì›','') # ì´ê²ƒë„ pipelines.pyì—ì„œ í›„ì²˜ë¦¬ ê°€ëŠ¥í•¨
        
        doc['main_category_name'] = response.meta['maincategory_name'] # ìœ„ ë©”ì„œë“œì—ì„œ ê°€ì ¸ì˜¨ ë°ì´í„°ë¥¼ Item(í•„ë“œ)ì— ë„£ì–´ì¤Œ
        doc['sub_category_name'] = response.meta['subcategory_name']
        doc['ranking'] = ranking
        doc['title'] = title
        doc['ori_price'] = ori_price
        doc['dis_price'] = dis_price
 
        yield doc # ë§ˆì§€ë§‰ìœ¼ë¡œ Itemì— ë°ì´í„° ì €ì¥
```

- (&) - ê°œë°œì ë„êµ¬(F12)ë¡œ ë°˜ë“œì‹œ ê²€ìƒ‰í•´ë³´ê¸°
  
    ![4](/scrapy/6-4/4.png)
    

```python
#st11_best.py: ìµœì¢… ì½”ë“œ
import scrapy
from st11.items import St11Item

class St11BestSpider(scrapy.Spider):
    name = 'st11_best'

    def start_requests(self):
        yield scrapy.Request(url="https://www.11st.co.kr/browsing/BestSeller.tmall?method=getBestSellerMain&cornerNo=0",
                             callback=self.parse_mainpages)
                
    def parse_mainpages(self, response):
        print("parse_mainpages")
        category_names = response.css(quiz:ë©”ì¸ ì¹´í…Œê³ ë¦¬ëª…ì˜ css ì„ íƒì ê²½ë¡œ).getall()
        for idx, name in enumerate(category_names):
            yield scrapy.Request(url="https://www.11st.co.kr/browsing/BestSeller.tmall?method=getBestSellerMain&cornerNo="+str(idx), 
                                 callback=self.parse_items,
                                 meta={'maincategory_name':category_names[idx], 'subcategory_name':'All'})
                        
    def parse_items(self, response):
        print('parse_items', response.meta['maincategory_name'], response.meta['subcategory_name'])
        best_items = response.css('div.viewtype.catal_ty')
        for idx, item in enumerate(best_items[1].css('li')):
            doc = St11Item()
            
            ranking = idx + 1
            title = item.css(quiz:ë² ìŠ¤íŠ¸ ìƒí’ˆëª…ì˜ css ì„ íƒì ê²½ë¡œ).get().strip()
            ori_price = item.css(quiz:ê¸°ì¡´ê°€ê²©ì˜ css ì„ íƒì ê²½ë¡œ).get()
            dis_price = item.css(quiz:í• ì¸ê°€ê²©ì˜ css ì„ íƒì ê²½ë¡œ).get()
            
            if ori_price == None:
                ori_price = dis_price
            ori_price = ori_price.replace(',','').replace('ì›','')
            dis_price = dis_price.replace(',','').replace('ì›','')
            
            doc['main_category_name'] = response.meta['maincategory_name']
            doc['sub_category_name'] = response.meta['subcategory_name']
            doc['ranking'] = ranking
            doc['title'] = title
            doc['ori_price'] = ori_price
            doc['dis_price'] = dis_price
     
            yield doc
```

ë§Œì•½ ì‹¤í–‰ì´ ì˜ ë˜ì—ˆë‹¤ë©´ ì´ëŸ° ê²°ê³¼ê°€ í„°ë¯¸ë„ì— ì­ˆ~ìš± ë‚˜ì˜¬ ê²ë‹ˆë‹¤. ì§ì ‘ ì‚¬ì´íŠ¸ì˜ ë‚´ìš©ê³¼ ë§ëŠ”ì§€ ëŒ€ì¡°í•´ë³´ì„¸ìš” ğŸ§

![5](/scrapy/6-4/5.png)

ì°¸ê³ ë¡œ ì‹¤í–‰ í™”ë©´ì—ì„œ ë­í‚¹ì´ë‚˜ ì¹´í…Œê³ ë¦¬ ë“±ì´ ìˆœì„œëŒ€ë¡œ ì¶œë ¥ë˜ì§€ ì•Šì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë°ì´í„°ì™€ itemë“¤ì˜ ìˆœì„œê°€ ë’¤ì£½ë°•ì£½ì¸ ì´ìœ ëŠ”, Scrapyê°€ í¬ë¡¤ë§ í•  ë•Œ ì—¬ëŸ¬ ê°œì˜ spider(í¬ë¡¤ëŸ¬)ê°€ ì‘ë™í•˜ê¸° ë•Œë¬¸ì…ë‹ˆë‹¤. ì—¬ëŸ¬ ê°œì˜ spiderê°€ í¬ë¡¤ë§ í•˜ë©´ì„œ ì†ë„ëŠ” ë¹¨ë¼ì§€ì§€ë§Œ, ë¹ ë¥¸ ìˆœì„œëŒ€ë¡œ í¬ë¡¤ë§í•˜ê¸° ë•Œë¬¸ì— í¬ë¡¤ë§í•˜ì—¬ ì¶œë ¥, ì €ì¥ë˜ëŠ” ìˆœì„œëŠ” ì„ì´ê²Œ ë˜ëŠ” ê²ƒì´ì£ .

![6](/scrapy/6-4/6.png)
